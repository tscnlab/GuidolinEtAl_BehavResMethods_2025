---
title: "metrics_comparison"
author: "Carolina Guidolin"
date: "2024-11-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Calculating metrics using different datasets
The aim of this script is to calculate and compare light metrics on three different datasets:
1. A raw dataset, where non-wear information is ignored (i.e., we include all data regardless of whether it is wear or non-wear)
2. A dataset where non-wear information is identified using self-reported non-wear time (wear log)
3. A dataset where non-wear information is identified by detecting clusters of low illuminance

### Creation of the three datasets
Before performing the comparison, we need to identify these three datasets. 
```{r}
# 1. Raw dataset: this is the raw data, i.e. dataset.LL.wrlg
raw_dataset <- dataset.LL.wrlg

# 2. Non-wear by wear log dataset. We need to create this from dataset.LL.wrlg
nw_wrlg <- dataset.LL.wrlg %>% 
  mutate(MEDI = if_else(State == "off", NA, MEDI))

#3. Non-wear by detection of clusters of low illuminance. We will use the dataset where padding has been added to transition states (see script classification_summary.Rmd). 
nw_clusters <- nw_alg %>%
  mutate(MEDI = if_else(is_low_medi_cluster == 0, NA, MEDI))

```

### Data prep
```{r}
# Exclude Monday since this day does not contain full data. Do this for all three data frames
raw_dataset <- raw_dataset %>% dplyr::filter(weekdays(Datetime) != "Monday")
nw_wrlg <- nw_wrlg %>% dplyr::filter(weekdays(Datetime) != "Monday")
nw_clusters <- nw_clusters %>% dplyr::filter(weekdays(Datetime) != "Monday")
```

### 1. Intradaily stability 
```{r}
# 1a. raw dataset
is_raw_dataset <- raw_dataset %>% 
  summarize(
    IS = interdaily_stability(
      Light.vector = MEDI,
      Datetime.vector = Datetime
    )
  )

# 1b. With Wear log based non-wear 
is_nw_wrlg <- nw_wrlg %>% 
  summarize(
    IS = interdaily_stability(
      Light.vector = MEDI,
      Datetime.vector = Datetime,
      na.rm = TRUE
    )
  )

# 1c. With cluster based non-wear
is_nw_clusters <- nw_clusters %>%
  summarize(
    IS = interdaily_stability(
      Light.vector = MEDI,
      Datetime.vector = Datetime,
      na.rm = TRUE
    )
  )

  
```

### 1b. Intradaily 
