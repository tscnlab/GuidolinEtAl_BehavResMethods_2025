---
title: "nw_visual_insp"
author: "Carolina Guidolin"
date: "2024-04-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Test this out only on one participant
subset_df <- dataset.LL.clean %>%
  filter(Id == "201") %>%
  select(Id, Datetime, EVENT, PIM, MEDI, State, bag)


#Let's start by plotting mEDI and activity (PIM) over the week
p1 <- gg_day(data = subset_df, size = 0.25, color = "#EFC000", geom = "line", x.axis.label = "Time", title = "P201 light exposure over 7 days") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_line(aes(y=PIM), colour = "lightblue", alpha = 0.5) 

#Now we want to add a red dot on the mEDI line for everytime the event button was pressed. First, we add a new column for the y-values of points where EVENT==1
subset_df$EventPoint <- ifelse(subset_df$EVENT == 1, subset_df$MEDI, NA)

p2 <- p1 + geom_point(aes(y = EventPoint), color = "red", size = 1) +
  geom_rect(xmin = "2023-08-14:") +  # Add shaded rectangles based on State intervals

#Now we want to shade the areas according to wearlog states
state.times <- joined_int %>%
  filter(Id == "201" & !is.na(State)) %>%
  mutate(xmin = int_start(Interval),
         xmax = int_end(Interval))

states <- geom_rect(data=state.times, aes(xmin= xmin, xmax = xmax, ymin =0, ymax = Inf, fill = State),
                    inherit.aes = FALSE,
                    alpha = 0.15)

p2$layers <- c(states, p2$layers )

p2 + 
  annotate("rect", )

ggsave(filename = "raw_plot_201.pdf",
       plot = p1,
       width = 8,
       height = 14,
       dpi = 600,
       path= "F:/cyepi/code/outputs")



p1 + geom_point(data = event_points, aes(y=EVENT), color = "red", size = 2)
```

## Including Plots

You can also embed plots, for example:

```{r}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
